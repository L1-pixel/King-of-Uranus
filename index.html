<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>King of Uranus</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
  #mobileControls {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 15px;
  z-index: 9999;
}
#mobileControls button {
  font-size: 28px;
  padding: 12px 20px;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.15);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.3);
}
#mobileControls button:active {
  background: rgba(255, 255, 255, 0.35);
}
<style>
  html,body{margin:0;height:100%;background:#000;overflow:hidden;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#fff}
  canvas{display:block;width:100vw;height:100vh}

  #hud{position:fixed;left:12px;top:10px;padding:8px 12px;border-radius:12px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.15);z-index:5;font-weight:700}
  #status{position:fixed;right:12px;top:10px;padding:8px 12px;border-radius:12px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.15);z-index:5;font-weight:700;color:#a6ffb0}
  #musicBtn{position:fixed;right:12px;top:50px;padding:6px 10px;border-radius:10px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.15);z-index:5;font-weight:700;cursor:pointer}

  #overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:10}
  .panel{background:rgba(0,0,0,.75);border:1px solid rgba(255,255,255,.22);border-radius:18px;padding:22px 26px;text-align:center;max-width:720px}
  .panel h1{margin:0 0 10px 0}
  .btn{display:inline-block;margin-top:12px;padding:12px 18px;border-radius:12px;background:#2a84ff;color:#fff;font-weight:bold;border:0;cursor:pointer}

  .planet{display:block;margin:10px auto 0 auto;border-radius:12px;max-width:260px;width:70%;box-shadow:0 0 16px rgba(0,180,255,.35);object-fit:cover}
  .heroes{display:flex;gap:16px;justify-content:center;flex-wrap:wrap;margin-top:10px}
  .hero{min-width:180px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.15);cursor:pointer;background:rgba(255,255,255,.06)}
  .hero:hover{background:rgba(255,255,255,.12)}
  .hero img{display:block;width:160px;height:160px;object-fit:cover;border-radius:10px;margin-bottom:8px}
</style>
</head>
<body>
<canvas id="cv"></canvas>
<div id="hud">Score: 0</div>
<div id="status">Ready</div>
<button id="musicBtn" type="button" title="Toggle music">Music: On</button>

<div id="overlay">
  <div class="panel">
    <!-- HOME -->
    <div id="viewHome">
      <h1>Kings of Uranus</h1>
      <img id="uranusThumb" class="planet" alt="Uranus">
      <div><button id="startBtn" class="btn" type="button">Gas it</button></div>
    </div>

    <!-- HERO SELECT -->
    <div id="viewHeroes" style="display:none">
      <h2 style="margin:0 0 8px 0">Choose hero</h2>
      <div class="heroes">
        <button class="hero" data-hero="weremeow">
          <img src="images/88C0CBDD-1053-43AA-8962-84192C0EA47C.jpeg" alt="weremeow">
          <div><b>weremeow</b></div>
        </button>
        <button class="hero" data-hero="wassieloyer">
          <img src="images/4ECA7A52-58EC-43C9-8046-A2A864A4F3EC.jpeg" alt="wassieloyer">
          <div><b>wassieloyer</b></div>
        </button>
      </div>
      <div><button id="backBtn" class="btn" type="button" style="background:#3a3a3a">Back</button></div>
    </div>

    <!-- GAME OVER -->
    <div id="viewOver" style="display:none">
      <img id="overUranus" class="planet" alt="Uranus">
      <div><button id="againBtn" class="btn" type="button">Gas it again</button></div>
    </div>
  </div>
</div>

<script>
'use strict';
(function(){
  // ---------- helpers ----------
  function loadImg(src, cb){ var im=new Image(); im.onload=function(){cb(im)}; im.onerror=function(){cb(null)}; im.src=src; }
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function lerp(a,b,t){ return a+(b-a)*t; }

  // ---------- canvas ----------
  var cvs=document.getElementById('cv');
  var ctx=cvs.getContext('2d',{alpha:false});
  function resize(){ var dpr=Math.max(1,Math.min(2,window.devicePixelRatio||1)); cvs.width=Math.floor(window.innerWidth*dpr); cvs.height=Math.floor(window.innerHeight*dpr); ctx.setTransform(dpr,0,0,dpr,0,0); ctx.imageSmoothingEnabled=true; ctx.imageSmoothingQuality='high'; }
  window.addEventListener('resize',resize,{passive:true}); resize();

  // ---------- DOM ----------
  var hud=document.getElementById('hud');
var statusEl=document.getElementById('status');
  var musicBtn=document.getElementById('musicBtn');
  var overlay=document.getElementById('overlay');
  var vHome=document.getElementById('viewHome');
  var vHeroes=document.getElementById('viewHeroes');
  var vOver=document.getElementById('viewOver');
  var startBtn=document.getElementById('startBtn');
  var backBtn=document.getElementById('backBtn');
  var againBtn=document.getElementById('againBtn');
  var uranusThumb=document.getElementById('uranusThumb');
  var overUranus=document.getElementById('overUranus');

  // ---------- assets ----------
  var jupiter=null, rocket=null, heroImg=null, uranus=null;

  loadImg('images/5307009B-2EF3-43AE-9A33-E08E11338E1E.JPG', function(im){ jupiter=im; });
  loadImg('images/2574D401-839C-4588-84E9-667896508499.jpeg', function(im){
    uranus=im;
    if(im){ uranusThumb.src=im.src; overUranus.src=im.src; }
    else { uranusThumb.style.display='none'; overUranus.style.display='none'; }
  });

  var HERO_SRC={
    weremeow:'images/88C0CBDD-1053-43AA-8962-84192C0EA47C.jpeg',
    wassieloyer:'images/4ECA7A52-58EC-43C9-8046-A2A864A4F3EC.jpeg'
  };

  var ROCKET_SRC='images/821C88C4-4AA7-4CD6-8159-4B6C63D85794.jpeg';

  var asteroidImgs=[];
  loadImg('images/asteroid1.jpg', function(im){ if(im) asteroidImgs.push(im); });
  loadImg('images/asteroid2.jpg', function(im){ if(im) asteroidImgs.push(im); });

  // ---------- audio (music + shot) ----------
  var AC=null, master=null, musicGain=null;
  var musicLoopTimer=null, musicOn=true, musicRunning=false;

  function ensureAC(){
    if(!AC){
      try{
        AC=new (window.AudioContext||window.webkitAudioContext)();
        master=AC.createGain(); master.gain.value=0.7; master.connect(AC.destination);
        musicGain=AC.createGain(); musicGain.gain.value=0.05;
        musicGain.connect(master);
      }catch(e){}
    }
  }

  function beep(freq, dur, gain){
    if(!AC) return;
    var o=AC.createOscillator(), g=AC.createGain();
    o.type='square'; o.frequency.value=freq||900;
    g.gain.value=(gain!=null?gain:0.02);
    o.connect(g).connect(master);
    o.start(); o.stop(AC.currentTime+(dur||0.05));
  }

  // Простая чип-мелодия
  var MELODY = [
    [392,0.22],[523,0.22],[659,0.22],[523,0.22],
    [440,0.30],[392,0.18],[392,0.18],
    [349,0.26],[392,0.26],[523,0.26],[659,0.22],
    [784,0.34],[659,0.22],[523,0.22],[440,0.30]
  ];
  function scheduleMelody(startTime){
    var t=startTime||AC.currentTime;
    for(var i=0;i<MELODY.length;i++){
      var f=MELODY[i][0], d=MELODY[i][1];
      var o=AC.createOscillator();
      var g=AC.createGain();
      o.type='sine'; o.frequency.setValueAtTime(f,t);
      g.gain.setValueAtTime(0.0001,t);
      g.gain.exponentialRampToValueAtTime(0.08,t+0.02);
      g.gain.exponentialRampToValueAtTime(0.0001,t+d);
      o.connect(g).connect(musicGain);
      o.start(t); o.stop(t+d+0.01);
      t+=d+0.02;
    }
    return t - (startTime||AC.currentTime);
  }
  function startMusic(){
    if(!musicOn || musicRunning) return;
    ensureAC(); if(!AC) return;
    if(AC.state==='suspended') AC.resume();
    var length = scheduleMelody();
    musicRunning = true;
    musicLoopTimer = setTimeout(function(){ musicRunning=false; startMusic(); }, Math.max(200, length*1000-50));
  }
  function stopMusic(){ musicRunning=false; if(musicLoopTimer){ clearTimeout(musicLoopTimer); musicLoopTimer=null; } }
  musicBtn.onclick=function(){ musicOn=!musicOn; musicBtn.textContent='Music: '+(musicOn?'On':'Off'); if(musicOn){startMusic()}else{stopMusic()} };

  // ---------- phrases (text bubbles over hero) ----------
  var LINES = [
    "Uranus looks good",
    "Gas it",
    "Ten bucks for Uranus",
    "I'm the king of Uranus"
  ];
  var chat = { text:'', ttl:0, max:0 }; // ttl — сколько ещё показывать, max — для альфы

  function showChat(line, seconds){
    chat.text = line;
    chat.ttl  = seconds||2.2;
    chat.max  = chat.ttl;
  }

  // ---------- state ----------
  var S={
    ui:'home',
    running:false, over:false, wait:0,
    score:0, starsT:0,
ship:{x:110, y:window.innerHeight/2, r:26, vy:0, tilt:0, bobT:0, recoil:0},
    input:{up:false,down:false,shoot:false},
    bullets:[], fireCD:0, fireRate:0.18,
    rocks:[], spawn:0.6, spawnEvery:1.2,
    exhaust:[], exhT:0,
    muzzle:0,
    hero:'',
    phraseT:0 // таймер до следующей реплики
  };

  function setStatus(t,c){ statusEl.textContent=t; if(c) statusEl.style.color=c; }
  function setScore(){ hud.textContent='Score: '+Math.floor(S.score); }
  function setHudVisible(v){ hud.style.display=v?'':'none'; statusEl.style.display=v?'':'none'; }

  function show(id){
    vHome.style.display=(id==='home')?'':'none';
    vHeroes.style.display=(id==='heroes')?'':'none';
    vOver.style.display=(id==='over')?'':'none';
    overlay.style.display='flex'; setHudVisible(false); S.ui=id;
  }
  function hideOverlay(){ overlay.style.display='none'; setHudVisible(true); }

  // ---------- flows ----------
  startBtn.onclick=function(){ show('heroes'); setStatus('Choose hero','#cfe9ff'); };
  backBtn.onclick=function(){ show('home'); setStatus('Ready','#a6ffb0'); stopMusic(); };

  vHeroes.onclick=function(e){
    var btn=e.target.closest('.hero'); if(!btn) return;
    var name=btn.getAttribute('data-hero'); S.hero=name;
    loadImg(HERO_SRC[name], function(im){
      heroImg=im;
      loadImg(ROCKET_SRC, function(r){
        rocket=r; startGame();
      });
    });
  };

  againBtn.onclick=function(){ restart(); };

  function startGame(){
    ensureAC();
    hideOverlay();
    S.running=false; S.over=false; S.wait=0.5;
    S.score=0; S.bullets.length=0; S.rocks.length=0; S.fireCD=0; S.spawn=0.6;
    S.ship.vy=0; S.ship.tilt=0; S.ship.bobT=0; S.ship.recoil=0;
    S.exhaust.length=0; S.exhT=0; S.muzzle=0;
    chat.ttl=0; S.phraseT=0; // обнулим реплики
    setScore(); setStatus('Launching…','#cfe9ff');
    startMusic();
  }
  function gameOver(){
    S.running=false; S.over=true;
    S.bullets.length=0; S.rocks.length=0; S.exhaust.length=0; S.muzzle=0;
    stopMusic();
    show('over'); setStatus('Ready','#a6ffb0');
  }
  function restart(){ S.ship.y=window.innerHeight/2; startGame(); }

  // ---------- input ----------
  document.addEventListener('keydown', function(e){
    if(e.code==='ArrowUp'||e.code==='KeyW'){ S.input.up=true; e.preventDefault(); }
    if(e.code==='ArrowDown'||e.code==='KeyS'){ S.input.down=true; e.preventDefault(); }
    if(e.code==='Space'){ S.input.shoot=true; e.preventDefault(); }
  });
  document.addEventListener('keyup', function(e){
    if(e.code==='ArrowUp'||e.code==='KeyW') S.input.up=false;
    if(e.code==='ArrowDown'||e.code==='KeyS') S.input.down=false;
    if(e.code==='Space') S.input.shoot=false;
  });

  // ---------- background ----------
  function drawBG(dt){
    var W=window.innerWidth,H=window.innerHeight;
    ctx.fillStyle='#000'; ctx.fillRect(0,0,W,H);
    S.starsT += dt*80;
    for(var i=0;i<180;i++){
      var x=((i*73)-(S.starsT%(W+240)))%(W+240)-120;
      var y=(i*131)%H;
      ctx.fillStyle='#fff'; ctx.fillRect(x,y,1.2,1.2);
    }
    var m=Math.min(W,H)*0.04;
    if(jupiter){
      var box=Math.min(W,H)*0.18, iw=jupiter.naturalWidth, ih=jupiter.naturalHeight;
      var s=Math.min(box/iw,box/ih), dw=Math.floor(iw*s), dh=Math.floor(ih*s);
      ctx.drawImage(jupiter, W-m-dw, m, dw, dh);
    }
  }

  // ---------- difficulty scaling ----------
  function asteroidSpeedMultiplier(){
    return 1 + Math.min(1.5, S.score * 0.01); // до 2.5x
  }

  // ---------- ship + exhaust ----------
  function updateShip(dt){
    if(S.wait>0||!S.running||S.over) return;
    var thrustUp   = S.input.up ? -380 : 0;
    var thrustDown = S.input.down ?  380 : 0;
    var accel = (thrustUp + thrustDown) - S.ship.vy*3.2;
    S.ship.vy += accel*dt;
    S.ship.y  += S.ship.vy*dt;

    var minY=S.ship.r+6, maxY=window.innerHeight-S.ship.r-6;
    if(S.ship.y<minY){ S.ship.y=minY; S.ship.vy=0; }
    if(S.ship.y>maxY){ S.ship.y=maxY; S.ship.vy=0; }

    var targetTilt = clamp(-S.ship.vy*0.0035, -0.45, 0.45);
    S.ship.bobT += dt*2.2;
    targetTilt += Math.sin(S.ship.bobT)*0.02;
    S.ship.tilt = lerp(S.
ship.tilt, targetTilt, 0.18);

    if(S.ship.recoil>0) S.ship.recoil = Math.max(0, S.ship.recoil - dt*220);

    // быстрый выхлоп
    S.exhT += dt;
    if (S.exhT >= 0.08) {
      S.exhT = 0;
      var px = S.ship.x - 48;
      var py = S.ship.y + Math.sin(S.ship.bobT*3)*1.5;
      S.exhaust.push({
        x:px, y:py + (Math.random()*6 - 3),
        vx:-280 - Math.random()*140, vy:(Math.random()*26 - 13),
        life:0.015 + Math.random()*0.015, max:0.03,
        r:0.9 + Math.random()*1.2, alpha:0.15 + Math.random()*0.1
      });
      if (S.exhaust.length > 60) S.exhaust.splice(0, S.exhaust.length - 60);
    }
  }

  function drawExhaust(dt){
    for (var i = S.exhaust.length - 1; i >= 0; i--) {
      var p = S.exhaust[i];
      p.x += p.vx * dt; p.y += p.vy * dt; p.life -= dt;
      if (p.life <= 0 || p.x < -30) { S.exhaust.splice(i,1); continue; }
      var a = p.life / (p.max || 0.03);
      if (a <= 0.25) { S.exhaust.splice(i,1); continue; }
      ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fillStyle = 'rgba(170,210,255,' + (0.18 * a * (p.alpha||0.25)) + ')';
      ctx.fill();
    }
  }

  function roundRectPath(x,y,w,h,r){
    r=Math.min(r, w*0.5, h*0.5);
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
  }

  function drawChatAboveShip(){
    if(chat.ttl<=0) return;
    var t = chat.ttl/chat.max;                // 1..0
    var a = Math.min(1, Math.max(0, t));      // альфа
    var yOff = -46 - (1-t)*8;                 // лёгкий подъём

    ctx.save();
    ctx.globalAlpha = a;

    ctx.font='600 14px system-ui,-apple-system,Segoe UI,Roboto,Arial';
    var paddingX=10, paddingY=7;
    var metrics = ctx.measureText(chat.text);
    var tw = Math.ceil(metrics.width);
    var bw = tw + paddingX*2;
    var bh = 24 + paddingY*2;

    var bx = S.ship.x - bw/2;
    var by = S.ship.y + yOff - bh;

    // тень/фон
    roundRectPath(bx, by, bw, bh, 12);
    ctx.fillStyle='rgba(0,0,0,0.65)';
    ctx.fill();
    ctx.strokeStyle='rgba(255,255,255,0.18)';
    ctx.lineWidth=1;
    ctx.stroke();

    // текст
    ctx.fillStyle='#e9f4ff';
    ctx.fillText(chat.text, bx + paddingX, by + paddingY + 18);
    ctx.restore();
  }

  function drawShip(){
    if(S.over || !rocket) return;
    var SW=110, SH=60;
    ctx.save();
    ctx.translate(S.ship.x - S.ship.recoil, S.ship.y);
    ctx.rotate(S.ship.tilt);
    ctx.drawImage(rocket, -SW*0.5, -SH*0.5, SW, SH);
    if(heroImg){
      var seatX=SW*0.20, seatY=-6, seatR=14;
      ctx.save(); ctx.beginPath(); ctx.arc(seatX,seatY,seatR,0,Math.PI*2); ctx.clip();
      ctx.drawImage(heroImg, seatX-seatR, seatY-seatR, seatR*2, seatR*2);
      ctx.restore();
      ctx.beginPath(); ctx.arc(seatX,seatY,seatR,0,Math.PI*2);
      ctx.strokeStyle='rgba(255,255,255,.9)'; ctx.lineWidth=2; ctx.stroke();
    }
    if(S.muzzle>0){
      ctx.globalAlpha = Math.min(1,S.muzzle/0.1);
      ctx.beginPath(); ctx.arc(SW*0.5-6, -4, 8, 0, Math.PI*2);
      ctx.fillStyle='#cfe9ff'; ctx.fill();
      ctx.globalAlpha = 1;
    }
    ctx.restore();

    drawExhaust(0);
    drawChatAboveShip();
  }

  // ---------- bullets ----------
  function tryShoot(){
    if(S.wait>0||!S.running||S.over||!S.input.shoot) return;
    if(S.fireCD>0) return;
    S.bullets.push({x:S.ship.x+58,y:S.ship.y-4,vx:560,r:4,life:2.5});
    S.fireCD=S.fireRate||0.18;
    S.ship.recoil = 18; S.muzzle = 0.12;
    beep(950, 0.04, 0.02);
  }
  function updBullets(dt){
    if(S.muzzle>0) S.muzzle -= dt;
    for(var i=S.bullets.length-1;i>=0;i--){
      var b=S.bullets[i]; b.x+=b.vx*dt; b.life-=dt;
      if(b.life<=0 || b.x>window.innerWidth+40) S.bullets.splice(i,1);
    }
  }
  function drawBullets(){
    if(S.over) return;
    for(var i=0;i<S.bullets.length;i++){
      var b=S.bullets[i];
      ctx.beginPath(); ctx.arc(b.x,b.y,b.r+2,0,Math.PI*2); ctx.fillStyle='rgba(160,220,255,0.25)'; ctx.fill();
      ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fillStyle='#cfe9ff'; ctx.fill();
    }
}

  // ---------- asteroids ----------
  function spawnRock(){
    var topLimit = 100;
    var bottomLimit = window.innerHeight - 100;

    var size = 16 + Math.random()*18;
    var y = topLimit + Math.random() * (bottomLimit - topLimit);
    var x = window.innerWidth + size + 80;

    var base = 180 * (0.85 + Math.random()*0.3);
    var speed = base * asteroidSpeedMultiplier();

    var spin = (Math.random()*2 - 1) * 1.0;
    var img = asteroidImgs.length ? asteroidImgs[(Math.random()*asteroidImgs.length)|0] : null;

    S.rocks.push({x:x,y:y,size:size,speed:speed,spin:spin,rot:0,hp:3,img:img});
  }
  function updRocks(dt){
    if(!S.running||S.wait>0||S.over) return;
    for(var i=S.rocks.length-1;i>=0;i--){
      var a=S.rocks[i]; a.x-=a.speed*dt; a.rot+=a.spin*dt;
      if(a.x<-50) S.rocks.splice(i,1);
    }
  }
  function drawRocks(){
    if(S.over) return;
    for(var i=0;i<S.rocks.length;i++){
      var a=S.rocks[i];
      ctx.save(); ctx.translate(a.x,a.y); ctx.rotate(a.rot);
      if(a.img){
        var d=a.size*2;
        ctx.drawImage(a.img, -d*0.5, -d*0.5, d, d);
      }else{
        ctx.beginPath();
        var n=10;
        for(var k=0;k<n;k++){
          var ang=(k/n)*Math.PI*2;
          var rad=a.size*(0.7+Math.random()*0.4);
          var px=Math.cos(ang)*rad, py=Math.sin(ang)*rad;
          if(k===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
        }
        ctx.closePath(); ctx.fillStyle='#999'; ctx.strokeStyle='#444'; ctx.lineWidth=2; ctx.fill(); ctx.stroke();
      }
      ctx.restore();
    }
  }

  // ---------- collisions ----------
  function collisions(){
    if(!S.running||S.wait>0||S.over) return;
    // bullets vs rocks
    for(var i=S.rocks.length-1;i>=0;i--){
      var a=S.rocks[i];
      for(var j=S.bullets.length-1;j>=0;j--){
        var b=S.bullets[j];
        var dx=b.x-a.x, dy=b.y-a.y;
        if(dx*dx+dy*dy <= (a.size+6)*(a.size+6)){
          a.hp--; S.bullets.splice(j,1);
          if(a.hp<=0){ S.rocks.splice(i,1); S.score+=5; setScore(); break; }
        }
      }
    }
    // ship vs rock
    for(var k=0;k<S.rocks.length;k++){
      var r=S.rocks[k];
      var dx=S.ship.x-r.x, dy=S.ship.y-r.y;
      var rr=(S.ship.r + r.size*0.85);
      if(dx*dx+dy*dy <= rr*rr){ gameOver(); return; }
    }
  }

  // ---------- loop ----------
  var last=performance.now();
  function frame(now){
    var dt=Math.min(0.033,(now-last)/1000); last=now;

    if(S.wait>0){ S.wait-=dt; if(S.wait<=0){ S.running=true; setStatus('Started','#a6ffb0'); } }

    if(S.running && !S.over){
      // таймер фраз
      S.phraseT += dt;
      if(S.phraseT >= 5){ S.phraseT = 0; var phrases=["Uranus looks good","Gas it","Ten bucks for Uranus","I'm the king of Uranus"]; showChat(phrases[(Math.random()*phrases.length)|0], 2.2); }
      if(chat.ttl>0) chat.ttl -= dt;

      if(S.fireCD>0) S.fireCD-=dt;
      S.spawn-=dt; if(S.spawn<=0){ spawnRock(); S.spawn=S.spawnEvery; }
      tryShoot(); updateShip(dt); updBullets(dt); updRocks(dt); collisions();
      S.score += dt*2; setScore();
    } else {
      if(chat.ttl>0) chat.ttl -= dt;
      for(var i=S.exhaust.length-1;i>=0;i--){
        var p=S.exhaust[i]; p.life-=dt; if(p.life<=0) S.exhaust.splice(i,1);
      }
    }

    ctx.clearRect(0,0,cvs.width,cvs.height);
    drawBG(dt); drawRocks(); drawBullets(); drawShip();

    requestAnimationFrame(frame);
  }

  // ---------- boot ----------
  show('home'); setStatus('Ready','#a6ffb0');
  requestAnimationFrame(frame);
})();
</script>
  <!-- Мобильные кнопки управления -->
<div id="mobileControls">
  <button id="btnUp">▲</button>
  <button id="btnShoot">●</button>
  <button id="btnDown">▼</button>
</div>

<script>
(() => {
  const btnUp = document.getElementById("btnUp");
  const btnDown = document.getElementById("btnDown");
  const btnShoot = document.getElementById("btnShoot");

  function hold(btn, action) {
    let interval;
    btn.addEventListener("touchstart", e => {
      e.preventDefault();
      action();
      interval = setInterval(action, 50);
    }, { passive: false });
    btn.addEventListener("touchend", () => clearInterval(interval));
  }

  if (typeof moveUp === "function") hold(btnUp, moveUp);
  if (typeof moveDown === "function") hold(btnDown, moveDown);
  if (typeof tryShoot === "function")
    btnShoot.addEventListener("touchstart", e => { e.preventDefault(); tryShoot(); }, { passive: false });
})();
</script>
</body>
</html>


